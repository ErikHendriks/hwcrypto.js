<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0049)https://www.openxades.org/web_sign_demo/sign.html -->
<HTML><HEAD><TITLE>Signing demo</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<SCRIPT type=text/javascript src="idCard.js"></SCRIPT>

<SCRIPT type=text/javascript>
		
		var certListLocal;

        function setHash(hash) {
            document.getElementById('hashHex').value = hash;
        }

        function getSelectedLanguage() {
            return document.getElementById('pluginLanguage').value;
        }

		function loadPlugin(){			
			try {		
				document.getElementById('error').innerHTML = '';
	    		loadSigningPlugin(getSelectedLanguage());
	            new IdCardPluginHandler(getSelectedLanguage()).getVersion(showVersion, showError);
	            document.getElementById('type').innerHTML = getType();
				document.getElementById('libraryVersion').innerHTML = libraryVersion;	
			}
			catch (ex) {
	            if (ex instanceof IdCardException) {
	                document.getElementById('error').innerHTML = '[Error code: ' + ex.returnCode + '; Error: ' + ex.message + ']';
	            } else {
	                document.getElementById('error').innerHTML = ex.message != undefined ? ex.message : ex;
	            }
			}
		}

        function getCert() {
			document.getElementById('error').innerHTML = '';
		    new IdCardPluginHandler(getSelectedLanguage()).getCertificate(showCert, showError);
        }

        function sign() {
			document.getElementById('error').innerHTML = '';
            new IdCardPluginHandler(getSelectedLanguage()).sign(document.getElementById('certId').value, document.getElementById('hashHex').value, showSignature, showError);
        }

        function showVersion(version) {
            document.getElementById('version').innerHTML = version;
        }

        function showCert(cert) {
            document.getElementById('certHex').value = cert.cert;
            document.getElementById('certId').value = cert.id;
        }

        function showSignature(signature) {
			document.getElementById('signatureHex').value = signature;
        }

        function showError(ex) {
            if (ex instanceof IdCardException) {
                document.getElementById('error').innerHTML = '[Error code: ' + ex.returnCode + '; Error: ' + ex.message + ']';
            } else {
                document.getElementById('error').innerHTML = ex.message != undefined ? ex.message : ex;
            }
        }

        </SCRIPT>

<META name=GENERATOR content="MSHTML 8.00.6001.18702"></HEAD>
<BODY onload="loadPlugin();">
<DIV id=pluginLocation></DIV>
<DIV style="COLOR: red" id=error></DIV>
<TABLE border=1 cellPadding=5>
  <TBODY>
  <TR>
    <TH colSpan=2>Digital signing in web browser (Plug-in version: <span id="version"></span>; plug-in type: <span id="type"></span>;  library version: <span id="libraryVersion"></span>)</TH></TR>
  <TR>
    <TD>1</TD>
    <TD>User is offered the possibility to sign some data on a web page. User confirms the data to be signed and initiates signing process.</TD></TR>
  <TR>
    <TD>2</TD>
    <TD>Web application displays web page where the digidocPlugin signing plug-in is loaded. </TD></TR>
  <TR>
    <TD>2.1</TD>
    <TD>Select language for the plug-in:
        <select id='pluginLanguage'>
            <option value='' selected='true'>default language (English)</option>
            <option value='est'>Estonian</option>
            <option value='eng'>English</option>
            <option value='rus'>Russian</option>
            <option value='lit'>Lithuanian</option>
        </select>
    </TD></TR>
  <TR>
    <TD><B>3<B></B></B></TD>
    <TD><B>Read the signer's certificate from signing token by calling out method getCertificate(successCallback, failureCallback) and return the result to the web application:</B> 
      <P><A id=getcertlink onclick=getCert() href="javascript:void(0);">Get certificate</A></P>
      <P></P>
      <TABLE>
        <TBODY>
        <TR>
          <TD>The chosen certificate (in HEX format):</TD>
          <TD><TEXTAREA id=certHex wrap=hard rows=5 cols=80 name=certHex></TEXTAREA></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD>4</TD>
    <TD>Calculate the hash to be signed in the web application (for example, use DigiDocService web service or DigiDoc libraries*). </TD></TR>
  <TR>
    <TD>5</TD>
    <TD>Web application loads web page where the hash to be signed is displayed and  digidocPlugin browser plug-in is loaded. </TD></TR>
  <TR>
    <TD><B>6</B></TD>
    <TD><B>Sign the hash value by calling out sign(id, hash, successCallback, failureCallback) method, return the signature value to the web application. </B> 
      <P></P>
      <TABLE>
        <TBODY>
        <TR>
          <TD>Certificate's ID:</TD>
          <TD><INPUT id=certId type=text></INPUT></TD></TR>
        <TR>
          <TD>Hash to be signed<BR>(in HEX format; <br>
              <a href="javascript:setHash('FAFA0101FAFA0101FAFA0101FAFA0101FAFA0101')">SHA-1 - 20 bytes</a>,<br>
              <a href="javascript:setHash('bf688a7ca189b1536de55c6e74d6c059ef96b8b6ee4f4f338f18bdf4')">SHA-224 - 28 bytes</a>,<br>
              <a href="javascript:setHash('1c3e17006e570bba9b0c2eae2ad2fc43785435ee70b6438e5b783fcb37886059')">SHA-256 - 32 bytes</a>,<br>
              <a href="javascript:setHash('bfd759b966b2ca1be24a446481ea5ffb7fbb12089d5bf11a104e30641a2b5d7b6668f79489a2f9c87ce38c96e1f718bac3f37626ba50d5f4dfdb8dcaaf9f33e9')">SHA-512 - 64 bytes)</a></TD>
          <TD><TEXTAREA id=hashHex rows=3 cols=80 name=hashHex>FAFA0101FAFA0101FAFA0101FAFA0101FAFA0101</TEXTAREA></TD></TR>
        <TR>
          <TD colSpan=2><A id=signlink onclick=sign() 
            href="javascript:void(0);">Sign</A></TD></TR>
        <TR>
          <TD>Signature:</TD>
          <TD><TEXTAREA id=signatureHex wrap=hard rows=5 cols=80 name=signatureHex></TEXTAREA></TD></TR></TBODY></TABLE></TD></TR>
  <TR>
    <TD>7</TD>
    <TD>Optionally compose the signed document by adding the signature value (for example, use DigiDocService web service or DigiDoc libraries*). </TD></TR>
  <TR>
    <TD>8</TD>
    <TD>Display a link for the user to download the signed document.</TD></TR></TBODY></TABLE>

		* - More information about DigiDocService can be found <a href="http://www.id.ee/?id=35785">here</a>. <br>
		* - More information about DigiDoc libraries is available <a href="http://id.ee/index.php?id=30486">here</a>.
    </body>
</html>
